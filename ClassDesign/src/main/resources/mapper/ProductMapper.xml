<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yl.cd.mapper.ProductMapper">
	<select id="getProductByName" parameterType="map" resultType="Cproduct">
		select * from (select t.*,rownum rownu from cproduct t where
		rownum&lt;=#{currPage}*#{pageSize} and 1=1 and cpstatus='normal'
		<choose>
			<when test="cproductname!=null and cproductname!=''">
				and cproductname like '%${cproductname}%'
			</when>
		</choose>
		)tt where tt.rownu>(#{currPage}-1)*#{pageSize}
	</select>

	<select id="getProductTotalAndTotalPage" parameterType="map"
		resultType="PaginationBean">
		select count(1) total,ceil(count(1)/${pageSize})
		totalPage,${pageSize}
		pageSize,${currPage} currPage from cproduct where 1=1 and
		cpstatus='normal'
		<choose>
			<when test="cproductname!=null and cproductname!=''">
				and cproductname like '%${cproductname}%'
			</when>
		</choose>
	</select>

	<select id="getAllHotProduct" resultType="Cproduct">
		select * from (select *
		from cproduct where cpstatus='normal' order by to_number(cpfree) desc)
		where rownum&lt;6
	</select>
	<select id="getAllComCount" resultType="Ccomments">
		select * from (select
		count(cfp) comcount,cfp from ccomments group by cfp order by comcount
		desc) where
		rownum&lt;6
	</select>
	<select id="getAllCommProduct" resultType="Cproduct">
		select * from cproduct
		where cpid=#{cfp}
	</select>

	<select id="getAllFavCount" resultType="Cfavorites">
		select * from (select
		count(cfp) favcount,cfp from cfavorites c where cfstatus='收藏' group by
		cfp order by
		favcount desc) where
		rownum&lt;6
	</select>

	<select id="getAllFavProduct" resultType="Cproduct">
		select * from cproduct
		where cpid=#{cfp}
	</select>

	<select id="getAllCountProduct" resultType="Integer">
		select count(1) from
		CPRODUCT where cpstatus='normal'
	</select>


	<select id="getProductByMan" resultType="Cproduct">
		<!-- select * from (select c.*,rownum rownu from cproduct c where rownum&lt;=#{currPage}*#{pageSize} 
			and cpstatus='normal' order by to_number(cpfree) asc) cp where cp.rownu>(#{currPage}-1)*#{pageSize} 
			and cp.rownu&lt;(select count(1)-4 from CPRODUCT) -->
		select * from
		(select m.*,rownum rn from
		(select * from cproduct where cpstatus='normal' order by to_number(cpfree)
		asc) m where #{currPage}*#{pageSize}>=rownum)
		where rn>(#{currPage}-1)*#{pageSize} and rn&lt;(select count(1)-4 from
		CPRODUCT)
	</select>

	<!-- <select id="getProductPageb" resultType="Cproduct"> select * from (select 
		m.*,rownum rn from (select * from cproduct where cpstatus='normal' order 
		by to_number(cpfree) asc) m where ${currPage}*${pageSize}>=rownum) where 
		rn>(${currPage}-1)*${pageSize} and rn&lt;(select count(1)-4 from cproduct) 
		</select> -->
	<select id="getProductPageByMan" resultType="PaginationBean">
		select count(1)-5
		total from CPRODUCT
	</select>

</mapper>